# 针对文件下载目录的特殊配置（如需）
# location /downloads/ {
#    alias /var/www/example.com/downloads/;
#    # 定义允许的根目录（配合path-validation.conf使用）
#    set $allowed_root "/var/www/example.com/downloads/";
#    # 引入路径规范化校验
#    include /etc/nginx/conf.d/security/path-validation.conf;
#    # 限制允许访问的文件类型
#    location ~* \.(zip|rar|pdf|docx)$ {
#        try_files $uri =404;
#    }
# }
# 路径规范化与范围校验
set $normalized_path "$request_filename";
# 递归消除路径中的../
if ($normalized_path ~* "^(.*)/\.\./(.*)$") {
    set $normalized_path "$1/$2";
    rewrite ^ $request_uri last;
}
# 验证路径是否在允许的根目录内（需在具体location中定义$allowed_root变量）
; if ($normalized_path !~ "^$allowed_root") {
;     # return 403;
;     deny all;
; }