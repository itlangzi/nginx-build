# 引入公共目录穿越防护配置
include conf.d/security/directory-traversal.conf;

set $wp_security_log $security_log;

# 禁止wp-content敏感目录中的PHP文件
location ~* /wp-content/(uploads|plugins|themes)/.*\.php$ {
    return 444;
    access_log $wp_security_log;
    log_not_found on;
}

# 禁止访问WordPress核心敏感文件
location ~* /(wp-config\.php|wp-config-sample\.php|readme\.html|license\.txt|changelog\.txt)$ {
    return 444;
    access_log $wp_security_log;
    log_not_found on;
}

location ~* \/(?:.author=) {
    return 444;
    access_log $wp_security_log;
    log_not_found on;
}

# 禁止访问xmlrpc.php
location = /xmlrpc.php {
    return 444;
    access_log $wp_security_log;
    log_not_found on;
}

limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/m;
location = /wp-login.php {
    limit_req zone=mylimit burst=20;
}